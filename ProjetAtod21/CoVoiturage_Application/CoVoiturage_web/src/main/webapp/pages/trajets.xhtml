<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition template="/template/commonLayout.xhtml">
	<ui:define name="title">Historique des Trajets</ui:define>

	<ui:define name="css">
		<link rel="stylesheet" href="../resources/css/common-style.css" />
		<link rel="stylesheet" href="../resources/css/jquery-ui-1.10.4.custom.css" />
		<link rel="stylesheet" href="../resources/css/histoTrajets.css" />
	</ui:define>

	<ui:define name="javascript">
		<script type="text/javascript" src="../resources/js/jquery-1.10.2.js"></script>
		<script type="text/javascript" src="../resources/js/jquery-ui-1.10.4.custom.js"></script>
		<script type="text/javascript" src="../resources/js/jquery-ui-1.10.4.custom.min.js"></script>
		<script type="text/javascript" src="../resources/js/index.js"></script>
	</ui:define>

	<ui:define name="content">
		<div>
			<h:outputLink styleClass="linkReturnIndex" value="../pages/index.xhtml">
				<h:graphicImage value="../resources/image/home.png" title="Retour à la page d'accueil" />
			</h:outputLink>
		</div>
		<div class="formHistoTrajet">
			<h:form>
				<ul>
					<li><h:outputLink styleClass="linkResearch" value="../pages/creerTrajet.xhtml">
						Créer un trajet
					</h:outputLink></li>

				</ul>
				<fieldset>
					<legend>Historique de mes Trajets</legend>

					<br />
					<h:panelGroup>
						<h:commandLink styleClass="classLink"
									   action="#{histoTrajetMBean.histoAllTrajets(connectionMBean.user)}">
							<h:outputLabel rendered="#{!histoTrajetMBean.activeHistoAll}">Tous mes trajets</h:outputLabel>
							<h:outputLabel styleClass="classRendered" rendered="#{histoTrajetMBean.activeHistoAll}">
								Tous mes trajets
							</h:outputLabel>
						</h:commandLink>
					
						<h:commandLink styleClass="classLink"
									   action="#{histoTrajetMBean.activeTypeHisto('passager')}">
							<h:outputLabel rendered="#{!histoTrajetMBean.activeHistoPassager}">En tant que Passager seulement</h:outputLabel>
							<h:outputLabel styleClass="classRendered" rendered="#{histoTrajetMBean.activeHistoPassager}">
								En tant que Passager seulement
							</h:outputLabel>
						</h:commandLink>
	
						<h:commandLink styleClass="classLink"
									   action="#{histoTrajetMBean.activeTypeHisto('conducteur')}">
							<h:outputLabel rendered="#{!histoTrajetMBean.activeHistoConducteur}">En tant que Conducteur seulement</h:outputLabel>
							<h:outputLabel styleClass="classRendered" rendered="#{histoTrajetMBean.activeHistoConducteur}">
								En tant que Conducteur seulement
							</h:outputLabel>
						</h:commandLink>

					</h:panelGroup>
					<br /> <br />
					
					<h:panelGroup rendered="#{histoTrajetMBean.activeHistoConducteur or histoTrajetMBean.activeHistoPassager}">
						<h:commandLink styleClass="classLink"
									   action="#{histoTrajetMBean.histoTrajetsByType(connectionMBean.user, 'en cours')}">
							<h:outputLabel rendered="#{!histoTrajetMBean.activeHistoEnCours}">Mes trajets en cours</h:outputLabel>
							<h:outputLabel styleClass="classRendered" rendered="#{histoTrajetMBean.activeHistoEnCours}">
								Mes trajets en cours
							</h:outputLabel>
						</h:commandLink>
	
						<h:commandLink styleClass="classLink"
									   action="#{histoTrajetMBean.histoTrajetsByType(connectionMBean.user, 'terminé')}">
							<h:outputLabel rendered="#{!histoTrajetMBean.activeHistoTermines}">Mes trajets terminés</h:outputLabel>
							<h:outputLabel styleClass="classRendered" rendered="#{histoTrajetMBean.activeHistoTermines}">
								Mes trajets terminés
							</h:outputLabel>
						</h:commandLink>
	
						<h:commandLink styleClass="classLink"
									   action="#{histoTrajetMBean.histoTrajetsByType(connectionMBean.user, 'proposé')}">
							<h:outputLabel rendered="#{!histoTrajetMBean.activeHistoProposes and histoTrajetMBean.activeHistoConducteur}">
								Mes trajets proposés
							</h:outputLabel>
							<h:outputLabel styleClass="classRendered" rendered="#{histoTrajetMBean.activeHistoProposes}">
								Mes trajets proposés
							</h:outputLabel>
						</h:commandLink>
					</h:panelGroup>
					<br /> <br />
					
					<h:panelGroup rendered="#{histoTrajetMBean.afficheHistoTrajets}">
						<h:panelGroup rendered="#{!empty histoTrajetMBean.listeHistoTrajets}">
						
							<h:dataTable cellpadding="20" cellspacing="30"
								styleClass="tableResultsTrajets" rowClasses="rowPair, rowInpair"
								headerClass="styleHeaderTableResultsTrajets"
								columnClasses="column1, column2, column3"
								value="#{histoTrajetMBean.listeHistoTrajets}" var="trajet">

								<h:column rendered="#{histoTrajetMBean.activeHistoAll}">
									<f:facet name="header">
										<h:outputText value="Statut du trajet" />
										<br /><br />
										<h:commandLink action="#{order.sortStatutByOrderDesc(histoTrajetMBean.listeHistoTrajets)}">
    										<h:graphicImage value="../resources/image/fleche-desc.png" title="Trier par ordre décroissant" />
    			   						</h:commandLink>
										<h:commandLink action="#{order.sortStatutByOrderAsc(histoTrajetMBean.listeHistoTrajets)}">
    										<h:graphicImage value="../resources/image/fleche-asc.png" title="Trier par ordre croissant" />
    			   						</h:commandLink>
									</f:facet>
									<h:outputLabel value="#{trajet.statut}" />
								</h:column>

								<h:column>
									<f:facet name="header">
										<h:outputText value="Conducteur" />
									</f:facet>
									<h:outputLabel rendered="#{connectionMBean.user.idUtilisateur != trajet.conducteurIdUser}"
										value="#{utilisateurMBean.getUserById(trajet.conducteurIdUser).civilite} #{utilisateurMBean.getUserById(trajet.conducteurIdUser).nom} #{utilisateurMBean.getUserById(trajet.conducteurIdUser).prenom}" />
									<h:outputLabel rendered="#{connectionMBean.user.idUtilisateur == trajet.conducteurIdUser}">
										<b>Moi</b>
									</h:outputLabel>
								</h:column>

								<h:column>
									<f:facet name="header">
										<h:outputText value="Type de véhicule" />
									</f:facet>
									<h:outputLabel value="#{utilisateurMBean.getUserById(trajet.conducteurIdUser).typeVehicule}" />
								</h:column>
								
								<h:column>
									<f:facet name="header">
										<h:outputText value="Date et heure de départ" />
									</f:facet>
									<h:outputLabel value="#{trajet.dateDepart}">

										<f:convertDateTime pattern="dd/MM/yyyy hh:mm"
											timeZone="Europe/Paris" />
									</h:outputLabel>
								</h:column>
								
								<h:column>
									<f:facet name="header">
										<h:outputText value="Ville de départ" />
										<br /><br />
										<h:commandLink action="#{order.sortVilleDepartByOrderDesc(histoTrajetMBean.listeHistoTrajets)}">
    										<h:graphicImage value="../resources/image/fleche-desc.png" title="Trier par ordre décroissant" />
    			   						</h:commandLink>
										<h:commandLink action="#{order.sortVilleDepartByOrderAsc(histoTrajetMBean.listeHistoTrajets)}">
    										<h:graphicImage value="../resources/image/fleche-asc.png" title="Trier par ordre croissant" />
    			   						</h:commandLink>
									</f:facet>
									<h:outputLabel value="#{trajet.villeDepart.nom}" />
								</h:column>
								
								<h:column>
									<f:facet name="header">
										<h:outputText value="Ville d'arrivée" />
										<br /><br />
										<h:commandLink action="#{order.sortVilleArriveeByOrderDesc(histoTrajetMBean.listeHistoTrajets)}">
    										<h:graphicImage value="../resources/image/fleche-desc.png" title="Trier par ordre décroissant" />
    			   						</h:commandLink>
										<h:commandLink action="#{order.sortVilleArriveeByOrderAsc(histoTrajetMBean.listeHistoTrajets)}">
    										<h:graphicImage value="../resources/image/fleche-asc.png" title="Trier par ordre croissant" />
    			   						</h:commandLink>
									</f:facet>
									<h:outputLabel value="#{trajet.villeArrivee.nom}" />
								</h:column>

								<h:column rendered="#{histoTrajetMBean.activeHistoEnCours or histoTrajetMBean.activeHistoProposes}">
									<f:facet name="header">
										<h:outputText value="Nombre de places restant" />
									</f:facet>
									<h:outputLabel value="#{trajet.nbPassagersRestant}" />
								</h:column>
								<h:column rendered="#{histoTrajetMBean.activeHistoTermines}">
									<f:facet name="header">
										<h:outputText value="Nombre de participants" />
									</f:facet>
									<h:outputLabel value="#{trajet.nbPassagersMax - trajet.nbPassagersRestant}" />
								</h:column>

								<h:column>
									<f:facet name="header">
										<h:outputText value="Action" />
									</f:facet>
									<h:commandLink action="#{histoTrajetMBean.consulterTrajet(trajet.idTrajet)}">
										<h:graphicImage value="../resources/image/consulter.png" title="Voir le détail de ce trajet" />
									</h:commandLink>
									<h:commandLink action="#{histoTrajetMBean.supprimerTrajet(trajet.idTrajet)}">
										<h:graphicImage value="../resources/image/supprimer.png" title="supprimer ce trajet" />
									</h:commandLink>
								</h:column>

							</h:dataTable>
						</h:panelGroup>
					</h:panelGroup>
				</fieldset>
			</h:form>
		</div>
	</ui:define>
</ui:composition>

</html>
